<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Hardware Inventory</title>
    <link rel="stylesheet" href="static/styles.css">
    <!-- AG Grid Community Edition -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@29.3.5/styles/ag-grid.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@29.3.5/styles/ag-theme-alpine.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@29.3.5/styles/ag-theme-alpine-dark.min.css">
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community@29.3.5/dist/ag-grid-community.min.js"></script>
</head>
<body>
    <!-- [Previous HTML content remains exactly the same until the script tag] -->
    <script>
        let userPermissions = [];
        let gridApi;
        let columnApi;
        let currentItem = null;
        let currentPage = 1;
        let totalPages = 1;

        // Column Definitions remain the same

        // Grid Options remain the same

        // Load room types function remains the same

        // Search functionality remains the same

        // Updated Load inventory data function
        async function loadInventory(page = 1) {
            try {
                currentPage = page;
                const searchTerm = document.getElementById('searchInput').value;
                
                const params = new URLSearchParams({
                    page: page,
                    search: searchTerm,
                    site_name: document.getElementById('filterSiteName')?.value || '',
                    room_number: document.getElementById('filterRoomNumber')?.value || '',
                    room_name: document.getElementById('filterRoomName')?.value || '',
                    room_type: document.getElementById('filterRoomType')?.value || '',
                    asset_tag: document.getElementById('filterAssetTag')?.value || '',
                    asset_type: document.getElementById('filterAssetType')?.value || '',
                    model: document.getElementById('filterModel')?.value || '',
                    serial_number: document.getElementById('filterSerialNumber')?.value || '',
                    assigned_to: document.getElementById('filterAssignedTo')?.value || '',
                    date_assigned_from: document.getElementById('filterDateAssignedFrom')?.value || '',
                    date_assigned_to: document.getElementById('filterDateAssignedTo')?.value || '',
                    date_decommissioned_from: document.getElementById('filterDateDecommissionedFrom')?.value || '',
                    date_decommissioned_to: document.getElementById('filterDateDecommissionedTo')?.value || ''
                });

                const response = await fetch(`/api/hardware?${params.toString()}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                
                // Update grid with items
                gridApi.setRowData(data.items);
                
                // Update pagination info
                currentPage = data.page;
                totalPages = data.total_pages;
                updatePaginationControls();
                
            } catch (error) {
                console.error('Error loading inventory:', error);
            }
        }

        // Updated pagination controls function
        function updatePaginationControls() {
            document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
            document.getElementById('prevPage').disabled = currentPage <= 1;
            document.getElementById('nextPage').disabled = currentPage >= totalPages;
        }

        // Initialize Grid
        document.addEventListener('DOMContentLoaded', () => {
            const gridDiv = document.querySelector('#myGrid');
            new agGrid.Grid(gridDiv, gridOptions);

            // Updated pagination event listeners
            document.getElementById('prevPage').addEventListener('click', () => {
                if (currentPage > 1) {
                    loadInventory(currentPage - 1);
                }
            });

            document.getElementById('nextPage').addEventListener('click', () => {
                if (currentPage < totalPages) {
                    loadInventory(currentPage + 1);
                }
            });

            // [Rest of the initialization code remains exactly the same]
        });
    </script>
</body>
</html>
