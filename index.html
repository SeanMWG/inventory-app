<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Hardware Inventory</title>
    <link rel="stylesheet" href="static/styles.css">
    <!-- AG Grid Styles -->
    <link href="https://cdn.jsdelivr.net/npm/ag-grid-community@29.3.5/styles/ag-grid.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/ag-grid-community@29.3.5/styles/ag-theme-alpine.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/ag-grid-community@29.3.5/styles/ag-theme-alpine-dark.css" rel="stylesheet">
    <!-- AG Grid Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-enterprise@29.3.5/dist/ag-grid-enterprise.min.js"></script>
</head>
<body>
    <!-- Previous HTML content remains the same until the grid section -->

    <!-- AG Grid with Pagination -->
    <div id="myGrid" class="ag-theme-alpine" style="height: 600px; width: 100%;"></div>
    <div class="pagination">
        <button id="firstPage" class="page-button">&lt;&lt;</button>
        <button id="prevPage" class="page-button">&lt;</button>
        <span id="pageInfo">Page 1 of 1</span>
        <button id="nextPage" class="page-button">&gt;</button>
        <button id="lastPage" class="page-button">&gt;&gt;</button>
    </div>

    <!-- Previous modal content remains the same -->

    <script>
        let userPermissions = [];
        let gridApi;
        let columnApi;
        let currentItem = null;
        let currentPage = 1;
        let totalPages = 1;

        // Column Definitions remain the same...

        // Load inventory data
        async function loadInventory(page = 1) {
            currentPage = page;
            const params = new URLSearchParams({
                page: page,
                site_name: document.getElementById('filterSiteName')?.value || '',
                room_number: document.getElementById('filterRoomNumber')?.value || '',
                room_name: document.getElementById('filterRoomName')?.value || '',
                asset_tag: document.getElementById('filterAssetTag')?.value || '',
                asset_type: document.getElementById('filterAssetType')?.value || '',
                model: document.getElementById('filterModel')?.value || '',
                serial_number: document.getElementById('filterSerialNumber')?.value || '',
                assigned_to: document.getElementById('filterAssignedTo')?.value || '',
                date_assigned_from: document.getElementById('filterDateAssignedFrom')?.value || '',
                date_assigned_to: document.getElementById('filterDateAssignedTo')?.value || '',
                date_decommissioned_from: document.getElementById('filterDateDecommissionedFrom')?.value || '',
                date_decommissioned_to: document.getElementById('filterDateDecommissionedTo')?.value || ''
            });

            try {
                const response = await fetch(`/api/hardware?${params.toString()}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                if (Array.isArray(data.items)) {
                    gridApi.setRowData(data.items);
                    totalPages = data.total_pages;
                    updatePagination();
                }
            } catch (error) {
                console.error('Error loading inventory:', error);
            }
        }

        // Update pagination controls
        function updatePagination() {
            document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
            document.getElementById('firstPage').disabled = currentPage === 1;
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage === totalPages;
            document.getElementById('lastPage').disabled = currentPage === totalPages;
        }

        // Initialize Grid
        document.addEventListener('DOMContentLoaded', () => {
            const gridDiv = document.querySelector('#myGrid');
            const gridOptions = {
                columnDefs: columnDefs,
                defaultColDef: {
                    flex: 1,
                    minWidth: 100,
                    resizable: true,
                    sortable: true,
                    filter: true,
                    menuTabs: ['filterMenuTab', 'columnsMenuTab']
                },
                rowData: [],
                suppressRowClickSelection: true,
                rowSelection: 'single',
                onGridReady: (params) => {
                    gridApi = params.api;
                    columnApi = params.columnApi;
                    
                    // Load saved column state
                    const savedState = localStorage.getItem('gridState');
                    if (savedState) {
                        columnApi.applyColumnState(JSON.parse(savedState));
                    }
                    
                    // Initial data load
                    loadInventory(1);
                },
                onRowClicked: (params) => showDetails(params.data),
                getRowHeight: () => 40,
                // Column state events
                onColumnMoved: (event) => {
                    const state = event.columnApi.getColumnState();
                    localStorage.setItem('gridState', JSON.stringify(state));
                },
                onColumnVisible: (event) => {
                    const state = event.columnApi.getColumnState();
                    localStorage.setItem('gridState', JSON.stringify(state));
                }
            };

            new agGrid.Grid(gridDiv, gridOptions);

            // Pagination event listeners
            document.getElementById('firstPage').addEventListener('click', () => loadInventory(1));
            document.getElementById('prevPage').addEventListener('click', () => loadInventory(currentPage - 1));
            document.getElementById('nextPage').addEventListener('click', () => loadInventory(currentPage + 1));
            document.getElementById('lastPage').addEventListener('click', () => loadInventory(totalPages));

            // Theme toggle
            const themeToggle = document.getElementById('themeToggle');
            const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
            
            function setTheme(isDark) {
                if (isDark) {
                    document.body.setAttribute('data-theme', 'dark');
                    themeToggle.innerHTML = '<span class="icon">ðŸŒœ</span><span class="text">Dark Mode</span>';
                    gridDiv.classList.remove('ag-theme-alpine');
                    gridDiv.classList.add('ag-theme-alpine-dark');
                } else {
                    document.body.removeAttribute('data-theme');
                    themeToggle.innerHTML = '<span class="icon">ðŸŒž</span><span class="text">Light Mode</span>';
                    gridDiv.classList.remove('ag-theme-alpine-dark');
                    gridDiv.classList.add('ag-theme-alpine');
                }
                if (gridApi) {
                    gridApi.redrawRows();
                }
            }
            
            // Set initial theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark' || (!savedTheme && prefersDarkScheme.matches)) {
                setTheme(true);
            }

            // Theme toggle click handler
            themeToggle.addEventListener('click', () => {
                const isDark = document.body.hasAttribute('data-theme');
                setTheme(!isDark);
                localStorage.setItem('theme', !isDark ? 'dark' : 'light');
            });

            // Previous event listeners remain the same...
        });

        // Previous functions (showDetails, editHardware, etc.) remain the same...
    </script>
</body>
</html>
